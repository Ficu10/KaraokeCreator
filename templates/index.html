<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karaoke Processor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css">
</head>
<body>
    <h1>Karaoke Processor</h1>

    <form id="uploadForm">
        <label for="audioFile">Wybierz plik audio:</label>
        <input type="file" id="audioFile" name="audio" accept=".mp3,.wav" required>

        <label for="language">Wybierz język:</label>
        <select id="language" name="language">
            <option value="pl" selected>Polski</option>
            <option value="en">Angielski</option>
            <option value="de">Niemiecki</option>
            <option value="fr">Francuski</option>
            <option value="es">Hiszpański</option>
            <option value="it">Włoski</option>
        </select>

        <button type="button" id="transcribeBtn">Transkrybuj</button>
        <button type="button" id="processBtn">Usuń Wokal</button>
    </form>

    <div id="results" style="display:none;">
        <h2>Transkrypcja</h2>
        <p id="transcription"></p>
        <h2>Plik bez wokalu</h2>
        <audio controls id="processedAudio"></audio>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
    <script>
        const transcribeBtn = document.getElementById('transcribeBtn');
        const processBtn = document.getElementById('processBtn');
        const fileInput = document.getElementById('audioFile');
        const languageInput = document.getElementById('language');
        const results = document.getElementById('results');
        const transcription = document.getElementById('transcription');
        const audioElement = document.getElementById('processedAudio');

        function uploadFile(url, callback, includeLanguage = false) {
            const formData = new FormData();
            formData.append('audio', fileInput.files[0]);

            if (includeLanguage) {
                formData.append('language', languageInput.value);
            }

            NProgress.start();

            fetch(url, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(callback)
                .catch(err => alert('Błąd: ' + err))
                .finally(() => NProgress.done());
        }

        transcribeBtn.addEventListener('click', () => {
            uploadFile('/transcribe', data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    transcription.textContent = data.transcription;
                    results.style.display = 'block';
                }
            }, true);
        });

        processBtn.addEventListener('click', () => {
            uploadFile('/process_audio', data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    audioElement.src = data.audio_url;
                    results.style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
